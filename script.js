(function(){var na={"0.js":"basis.data","1.js":"basis.event","2.js":"basis.entity","3.js":"basis.data.dataset","4.js":"basis.utils.info","5.js":"basis.utils.benchmark","6.js":"basis.utils.highlight"},ma={"0.css":"","0.js":function(h,w,e,G,H,C,I,Z){function v(c,a){return function(){c.apply(this,arguments);a.apply(this,arguments)}}function E(c){var a=T[c];if(!a)for(var x=[],b={},k=1,a=T[c]={actions:x,handler:b};c;){if(c&1){var d=L[k];x.push(d.action);for(var p in d.handler)b[p]=b[p]?v(b[p],d.handler[p]):
d.handler[p]}k<<=1;c>>=1}return a}function R(c,a){for(;a&&a!==c&&a!==a.delegate;)a=a.delegate;return a===c}function J(c,a,x){var b=c.delegate;b&&(c.root=b.root,c.target=b.target,c.data=b.data,c.state=b.state);if(c.root!==a){if(b=c.listen.root)a&&a!==c&&a.removeHandler(b,c),c.root&&c.root!==c&&c.root.addHandler(b,c);c.emit_rootChanged(a)}if(c.target!==x){if(b=c.listen.target)x&&x!==c&&x.removeHandler(b,c),c.target&&c.target!==c&&c.target.addHandler(b,c);c.emit_targetChanged(x)}for(c=c.delegates_;c;)c.delegate&&
J(c.delegate,a,x),c=c.next}function W(c,a){var x={},b;c&&c.length&&(b=x.inserted=c);a&&a.length&&(b=x.deleted=a);if(b)return x}function Y(c,a){if(c&&c.itemCount){if(a&&a.itemCount){var x=[],b=[],k;for(k in c.items_){var d=c.items_[k];!1==d.basisObjectId in a.items_&&b.push(d)}for(k in a.items_)d=a.items_[k],!1==d.basisObjectId in c.items_&&x.push(d);return W(x,b)}if(c.itemCount)return{deleted:c.getItems()}}else if(a&&a.itemCount)return{inserted:a.getItems()}}function u(c,a,x,b){var k=c[b]||null,d=
null;"function"==typeof x&&(x=x.call(c,c));x instanceof ba&&(d=new V(c,a,x,da),x=x.dataset);x instanceof e.Token&&(x=S.from(x));x instanceof S&&(d=new V(c,a,x,fa),x=u(d,d.proxy,x.value,"adapter_"));!1==x instanceof U&&(x=null);b&&k!==d&&(k&&(k.source.removeHandler(k.handler,k),k.adapter_&&u(k,null,null,"adapter_")),d&&d.source.addHandler(d.handler,d),c[b]=d);return x}function q(c){return Array.isArray(c)?c.map(function(c){return{data:c}}):{data:c}}function g(c){c&&c.constructor===Object||(c={value:c});
return new z({data:c})}e.require("./1.js");h=this.path;G=e.Class;var t=e.cleaner,Q=e.object.values;I=e.fn.$self;var r=e.event.Emitter;H=e.event.create;var D=e.event.events,y={},P=[],n={},s={priority:[],values:{},add:function(c,a){var x=c.toLowerCase();s[c]=x;n[x]=c;this.values[x]=c;a=a?this.priority.indexOf(a):-1;-1==a?this.priority.push(x):this.priority.splice(a,0,x)},getList:function(){return Q(n)}};s.add("READY");s.add("DEPRECATED");s.add("UNDEFINED");s.add("ERROR");s.add("PROCESSING");var L={},
M=1,F={NONE:0,ALL:0,link:function(c,a,x){c+=a.basisObjectId;var b=x.subscribers_;b||(b=x.subscribers_={});b[c]||(b[c]=a,1==(x.subscriberCount+=1)&&x.emit_subscribersChanged(1))},unlink:function(c,a,b){c+=a.basisObjectId;(a=b.subscribers_)&&a[c]&&(delete a[c],0==(b.subscriberCount-=1)&&(b.emit_subscribersChanged(-1),b.subscribers_=null))},add:function(c,a,b){L[M]={handler:a,action:b};F[c]=M;F.ALL|=M;M<<=1},addProperty:function(c,a){var b={};b[a||c+"Changed"]=function(a,b){b&&F.unlink(c,a,b);a[c]&&
F.link(c,a,a[c])};this.add(c.toUpperCase(),b,function(a,b){b[c]&&a(c,b,b[c])})}},T={};F.addProperty("delegate");F.addProperty("target");F.addProperty("dataset");var N=G(r,{className:h+".AbstractData",state:s.UNDEFINED,emit_stateChanged:H("stateChanged","oldState"),active:!1,emit_activeChanged:H("activeChanged"),subscribeTo:F.NONE,subscriberCount:0,subscribers_:null,emit_subscribersChanged:H("subscribersChanged","delta"),syncEvents:G.oneFunctionProperty(function(){this.isSyncRequired()&&this.syncAction()},
{stateChanged:!0,subscribersChanged:!0}),syncAction:null,init:function(){r.prototype.init.call(this);this.active&&this.addHandler(E(this.subscribeTo).handler);var c=this.syncAction;c&&(this.syncAction=null,this.setSyncAction(c))},setState:function(c,a){var b=String(c);if(!n[b])throw 142;if(this.state!=b||this.state.data!=a){var d=this.state;this.state=Object(b);this.state.data=a;this.emit_stateChanged(d);return!0}return!1},deprecate:function(){this.state!=s.PROCESSING&&this.setState(s.DEPRECATED)},
setActive:function(c){c=!!c;if(this.active!=c){this.active=c;this.emit_activeChanged();if(c){c=E(this.subscribeTo);for(var a=0,b;b=c.actions[a];a++)b(F.link,this);this.addHandler(c.handler)}else{c=E(this.subscribeTo);for(a=0;b=c.actions[a++];)b(F.unlink,this);this.removeHandler(c.handler)}return!0}return!1},setSubscription:function(c){var a=this.subscribeTo,b=c&F.ALL;if(c=a^b){this.subscribeTo=b;if(this.active){var d=E(a),b=E(b);this.removeHandler(d.handler);this.addHandler(b.handler);for(d=1;c;)c&
1&&(b=L[d],a&d?b.action(F.unlink,this):b.action(F.link,this)),d<<=1,c>>=1}return!0}return!1},isSyncRequired:function(){return 0<this.subscriberCount&&(this.state==s.UNDEFINED||this.state==s.DEPRECATED)},setSyncAction:function(c){var a=this.syncAction;"function"!=typeof c&&(c=null);(this.syncAction=c)?(a||this.addHandler(this.syncEvents),this.isSyncRequired()&&this.syncAction()):a&&this.removeHandler(this.syncEvents)},destroy:function(){r.prototype.destroy.call(this);if(this.active)for(var c=E(this.subscribeTo),
a=0,b;b=c.actions[a];a++)b(F.unlink,this);this.state=s.UNDEFINED}}),a={},b={},d=function(c){this.set(this.fn(c))},k={destroy:function(c){this.value.unlink(c,this.fn)}},p={destroy:function(c){this.set(null)}},S=G(N,{className:h+".Value",emit_change:H("change","oldValue")&&function(c){D.change.call(this,c);for(var a=this;a=a.links_;)a.fn.call(a.context,this.value,c)},value:null,initValue:null,proxy:null,locked:!1,lockedValue_:null,links_:null,setNullOnEmitterDestroy:!0,bindingBridge:{attach:function(c,
a,b){c.link(b,a,!0)},detach:function(c,a,b){c.unlink(b,a)},get:function(c){return c.value}},init:function(){N.prototype.init.call(this);this.proxy&&(this.value=this.proxy(this.value));this.setNullOnEmitterDestroy&&this.value instanceof r&&this.value.addHandler(p,this);this.initValue=this.value},set:function(c){var a=this.value;c=this.proxy?this.proxy(c):c;var b=c!==a;b&&(this.setNullOnEmitterDestroy&&(a instanceof r&&a.removeHandler(p,this),c instanceof r&&c.addHandler(p,this)),this.value=c,this.locked||
this.emit_change(a));return b},reset:function(){this.set(this.initValue)},lock:function(){this.locked||(this.locked=!0,this.lockedValue_=this.value)},unlock:function(){if(this.locked){var c=this.lockedValue_;this.lockedValue_=null;this.locked=!1;this.value!==c&&this.emit_change(c)}},compute:function(c,b){b||(b=c,c=null);var x=this,d=e.event.createHandler(c,function(c){this.set(b(c,x.value))}),k=d.events.concat(String(b),this.basisObjectId).join("_"),p=a[k];if(!p){var l={};d.destroy=function(c){delete l[c.basisObjectId];
this.destroy()};this.addHandler({change:function(){for(var c in l){var a=l[c];a.token.set(b(a.object,this.value))}},destroy:function(){for(var c in l){var a=l[c];a.object.removeHandler(d,a.token);a.token.destroy()}x=l=null}});p=a[k]=function(c){var a=c.basisObjectId,K=l[a];K||(K=new e.Token(b(c,x.value)),c.addHandler(d,K),K=l[a]={token:K,object:c});return K.token};p.deferred=function(){return function(c){return p(c).deferred()}}}return p},as:function(c,a){if(this.links_)for(var b=this;b=b.links_;)if(b.context instanceof
e.Token&&b.context.fn==String(c))return a?b.context.deferred():b.context;b=new e.Token;b.fn=c;this.link(b,d);return a?b.deferred():b},deferred:function(c){return this.as(c,!0)},link:function(c,a,d){if("function"!=typeof a){var p=String(a);(a=b[p])||(a=b[p]=function(c){this[p]=c})}this.links_={value:this,context:c,fn:a,links_:this.links_};c instanceof r&&c.addHandler(k,this.links_);d||a.call(c,this.value);return c},unlink:function(c,a){for(var b=this,d;d=b,b=b.links_;)b.context!==c||a&&b.fn!==a||(b.fn=
e.fn.$undef,d.links_=b.links_,b.context instanceof r&&b.context.removeHandler(k,b))},destroy:function(){N.prototype.destroy.call(this);this.setNullOnEmitterDestroy&&this.value instanceof r&&this.value.removeHandler(p,this);for(var c=this;c=c.links_;)c.context instanceof r&&c.context.removeHandler(k,c);this.links_=this.lockedValue_=this.value=this.initValue=this.proxy=null}}),l={};S.from=function(c,a,b){var d;if(!c)return null;if(c instanceof r){b||(b=a,a=null);a=e.event.createHandler(a,function(c){this.set(b(c))});
var k=a.events.concat(String(b),c.basisObjectId).join("_");d=l[k];d||(b=e.getter(b),d=l[k]=new S({value:b(c)}),a.destroy=function(c){delete l[k];this.destroy()},c.addHandler(a,d))}d||(k=c.basisObjectId,a=c.bindingBridge,k&&a&&(d=l[k],d||(d=l[k]=new S({value:a.get(c)}),a.attach(c,d.set,d))));if(!d)throw 143;return d};S.factory=function(c,a){return function(b){return S.from(b,c,a)}};var z=G(N,{className:h+".Object",subscribeTo:F.DELEGATE+F.TARGET,data:null,emit_update:H("update","delta")&&function(c){var a=
this.delegates_;for(D.update.call(this,c);a;)a.delegate&&a.delegate.emit_update(c),a=a.next},emit_stateChanged:function(c){var a=this.delegates_;for(N.prototype.emit_stateChanged.call(this,c);a;)a.delegate&&(a.delegate.state=this.state,a.delegate.emit_stateChanged(c)),a=a.next},delegate:null,delegates_:null,emit_delegateChanged:H("delegateChanged","oldDelegate"),target:null,emit_targetChanged:H("targetChanged","oldTarget"),root:null,emit_rootChanged:H("rootChanged","oldRoot"),init:function(){this.root=
this;N.prototype.init.call(this);var c=this.delegate;c?(this.target=this.delegate=null,this.data=c.data,this.state=c.state,this.setDelegate(c)):(this.data||(this.data={}),null!==this.target&&(this.target=this))},setDelegate:function(c){if(c&&c instanceof z){if(c.delegate&&R(this,c))return!1}else c=null;if(this.delegate!==c){var a=this.state,b=this.data,d=this.delegate,k=this.target,p=this.root,l={},e=!1,g=this.listen.delegate;if(d){g&&d.removeHandler(g,this);for(var K=d.delegates_;K;){if(K.delegate===
this){K.delegate=null;d===d?d.delegates_=K.next:d.next=K.next;break}K=K.next}}if(c){this.delegate=c;c.delegates_={delegate:this,next:c.delegates_};for(var f in c.data)!1===f in b&&(e=!0,l[f]=void 0);for(f in b)b[f]!==c.data[f]&&(e=!0,l[f]=b[f]);g&&c.addHandler(g,this)}else for(f in this.target=this.delegate=null,this.root=this,this.data={},b)this.data[f]=b[f];J(this,p,k);e&&this.emit_update(l);a===this.state||String(a)==this.state&&a.data===this.state.data||this.emit_stateChanged(a);this.emit_delegateChanged(d);
return!0}return!1},setState:function(c,a){return this.delegate?this.root.setState(c,a):N.prototype.setState.call(this,c,a)},update:function(c){if(this.delegate)return this.root.update(c);if(c){var a={},b=!1,d;for(d in c)this.data[d]!==c[d]&&(b=!0,a[d]=this.data[d],this.data[d]=c[d]);if(b)return this.emit_update(a),a}return!1},destroy:function(){N.prototype.destroy.call(this);var a=this.delegates_;for(this.delegates_=null;a;)a.delegate.setDelegate(),a=a.next;this.delegate&&this.setDelegate();this.data=
y;this.target=this.root=null}});C=G(z,{className:h+".Slot"});var ea={destroy:function(){delete this.map[this.itemId]}};I=G(null,{className:h+".KeyObjectMap",itemClass:z,keyGetter:I,map_:null,extendConstructor_:!0,init:function(){this.map_={};t.add(this)},resolve:function(a){return this.get(this.keyGetter(a),a)},create:function(a,b){var d={};a instanceof z?d.delegate=a:d.data={id:a,title:a};return new this.itemClass(d)},get:function(a,b){var d=a instanceof z?a.basisObjectId:a,k=this.map_[d];!k&&b&&
(k=this.map_[d]=this.create(a,b),k.addHandler(ea,{map:this.map_,itemId:d}));return k},destroy:function(){t.remove(this);for(var a=Q(this.map_),b=0,d;d=a[b++];)d.destroy()}});var ba=G(z,{className:h+".DatasetWrapper",subscribeTo:z.prototype.subscribeTo+F.DATASET,listen:{dataset:{itemsChanged:function(a,b){this.itemCount=a.itemCount;this.emit_itemsChanged(b)},destroy:function(){this.setDataset()}}},dataset:null,datasetAdapter_:null,emit_datasetChanged:H("datasetChanged","oldDataset"),emit_itemsChanged:H("itemsChanged",
"delta"),init:function(){z.prototype.init.call(this);var a=this.dataset;a&&(this.dataset=null,this.setDataset(a))},setDataset:function(a){a=u(this,this.setDataset,a,"datasetAdapter_");if(this.dataset!==a){var b=this.listen.dataset,d=this.dataset,k;b&&(d&&d.removeHandler(b,this),a&&a.addHandler(b,this));this.itemCount=a?a.itemCount:0;(k=Y(d,a))&&this.emit_itemsChanged(k);this.dataset=a;this.emit_datasetChanged(d)}},has:function(a){return this.dataset?this.dataset.has(a):null},getItems:function(){return this.dataset?
this.dataset.getItems():[]},pick:function(){return this.dataset?this.dataset.pick():null},top:function(a){return this.dataset?this.dataset.top(a):[]},forEach:function(a){if(this.dataset)return this.dataset.forEach(a)},destroy:function(){(this.dataset||this.datasetAdapter_)&&this.setDataset();z.prototype.destroy.call(this)}}),U=G(N,{className:h+".AbstractDataset",itemCount:0,items_:null,members_:null,cache_:null,emit_itemsChanged:H("itemsChanged","delta")&&function(a){var b,d=0,k=0,p;if(b=a.inserted)for(;p=
b[d];)this.items_[p.basisObjectId]=p,d++;if(b=a.deleted)for(;p=b[k];)delete this.items_[p.basisObjectId],k++;this.itemCount+=d-k;this.cache_=d==this.itemCount?a.inserted:null;D.itemsChanged.call(this,a)},init:function(){N.prototype.init.call(this);this.members_={};this.items_={}},has:function(a){return!(!a||!this.items_[a.basisObjectId])},getItems:function(){this.cache_||(this.cache_=Q(this.items_));return this.cache_},pick:function(){for(var a in this.items_)return this.items_[a];return null},top:function(a){var b=
[];if(a)for(var d in this.items_)if(b.push(this.items_[d])>=a)break;return b},forEach:function(a){for(var b=this.getItems(),d=0;d<b.length;d++)a(b[d])},clear:function(){},destroy:function(){this.clear();N.prototype.destroy.call(this);this.cache_=P;this.itemCount=0;this.items_=this.members_=null}}),X=G(U,{className:h+".Dataset",listen:{item:{destroy:function(a){this.remove([a])}}},init:function(){U.prototype.init.call(this);var a=this.items;a&&(this.items=null,this.set(a))},add:function(a){var b=this.members_,
d=this.listen.item,k=[],p;a&&!Array.isArray(a)&&(a=[a]);for(var l=0;l<a.length;l++){var e=a[l];if(e instanceof z){var g=e.basisObjectId;b[g]||(b[g]=e,d&&e.addHandler(d,this),k.push(e))}}k.length&&this.emit_itemsChanged(p={inserted:k});return p},remove:function(a){var b=this.members_,d=this.listen.item,k=[],p;a&&!Array.isArray(a)&&(a=[a]);for(var l=0;l<a.length;l++){var e=a[l];if(e instanceof z){var g=e.basisObjectId;b[g]&&(d&&e.removeHandler(d,this),delete b[g],k.push(e))}}k.length&&this.emit_itemsChanged(p=
{deleted:k});return p},set:function(a){if(!this.itemCount)return this.add(a);if(!a||!a.length)return this.clear();for(var b=this.members_,d=this.listen.item,k={},p=[],l=[],e,g,S,K=0;K<a.length;K++)e=a[K],e instanceof z&&(g=e.basisObjectId,k[g]=e,b[g]||(b[g]=e,d&&e.addHandler(d,this),l.push(e)));for(g in b)k[g]||(e=b[g],d&&e.removeHandler(d,this),delete b[g],p.push(e));(S=W(l,p))&&this.emit_itemsChanged(S);return S},sync:function(a){a=this.set(a)||{};var b=a.deleted;X.setAccumulateState(!0);if(b)for(var d=
0,k;k=b[d];d++)k.destroy();X.setAccumulateState(!1);return a.inserted},clear:function(){var a=this.getItems(),b=this.listen.item,d;if(a.length){if(b)for(d=0;d<a.length;d++)a[d].removeHandler(b,this);this.emit_itemsChanged(d={deleted:a});this.members_={}}return d}}),V=function(a,b,d,k){this.context=a;this.fn=b;this.source=d;this.handler=k};V.prototype.adapter_=null;V.prototype.proxy=function(){this.fn.call(this.context,this.source)};var da={datasetChanged:function(a){this.fn.call(this.context,a)},
destroy:function(){this.fn.call(this.context,null)}},fa={change:function(a){this.fn.call(this.context,a)},destroy:function(){this.fn.call(this.context,null)}};X.setAccumulateState=function(){function a(){var b=z;z={};for(var c in b){var f=b[c];p.call(f.dataset,f)}}function b(a){var c=this.basisObjectId,f=a.inserted,m=a.deleted,A=z[c];if(f&&m)A&&(delete z[c],p.call(A.dataset,A)),p.call(this,a);else{if(A){var O=A[f?"inserted":"deleted"];if(O){O.push.apply(O,f||m);return}p.call(A.dataset,A)}z[c]=a;a.dataset=
this}}function d(){g=null;l&&(l=0,k.emit_itemsChanged=p,a())}var k=U.prototype,p=k.emit_itemsChanged,l=0,g,z={};return function(z){z?(0==l&&(k.emit_itemsChanged=b,g||(g=e.setImmediate(d))),l++):(l-=0<l,0==l&&(k.emit_itemsChanged=p,a()))}}();w.exports={STATE:s,SUBSCRIPTION:F,AbstractData:N,Value:S,Object:z,Slot:C,KeyObjectMap:I,AbstractDataset:U,Dataset:X,DatasetWrapper:ba,DatasetAdapter:V,isConnected:R,getDatasetDelta:Y,resolveDataset:u,wrapData:q,wrapObject:g,wrap:function(a,b){var d=b?g:q;return Array.isArray(a)?
a.map(d):d(a)}}},"1.js":function(h,w,e,G,H,C,I,Z){function v(e){var h=R[e];h||(h=function(){for(var h=this,q,g;h=h.handler;){g=h.callbacks[e];if("function"==typeof g){if(!q){q=[this];for(var t=0;t<arguments.length;t++)q.push(arguments[t])}g.apply(h.context||this,q)}g=h.callbacks["*"];if("function"==typeof g){if(!q)for(q=[this],t=0;t<arguments.length;t++)q.push(arguments[t]);g.call(h.context||this,{sender:this,type:e,args:q})}}},R[e]=h);return h}h=e.Class;var E={},R={},J=function(){};h=h(null,{className:this.path+
".Emitter",extendConstructor_:!0,handler:null,emit_destroy:v("destroy"),listen:h.nestedExtendProperty(),init:function(){this.handler&&!this.handler.callbacks&&(this.handler={callbacks:this.handler,context:this,handler:null})},addHandler:function(e,h){this.handler={callbacks:e,context:h||this,handler:this.handler}},removeHandler:function(e,h){var u=this,q;for(h=h||this;q=u,u=u.handler;)if(u.callbacks===e&&u.context===h){u.callbacks=E;q.handler=u.handler;break}},destroy:function(){this.destroy=J;this.emit_destroy();
this.handler=null}});w.exports={create:v,createHandler:function(e,h){var u={events:[]};if(e){e=String(e).trim().split(/\s+|\s*,\s*/).sort();for(var u={events:e},q=0,g;g=e[q];q++)"destroy"!=g&&(u[g]=h)}return u},events:R,Emitter:h}},"2.js":function(h,w,e,G,H,C,I,Z){function v(a){ba[a]=ba[a]||0;return a+ba[a]++}function E(a,f){var m=X[a];if(m){for(var b=0,c;c=m[b];b++)c[0][c[1]]=f;delete X[a]}U[a]=f}function R(a,f,m){if(U[a])return U[a];var b=X[a];b||(b=X[a]=[]);b.push([f,m]);return function(f,m){var b=
U[a];if(b)return b(f,m)}}function J(){var a=M(arguments),f=a.pop(),m=a[0],b=a[1],c=a[2],d;if("function"!=typeof f)throw 145;switch(a.length){case 0:d=function(){return f()};break;case 1:d=function(a,b,A){return m in a?f(b[m]):A};break;case 2:d=function(a,c,d){return m in a||b in a?f(c[m],c[b]):d};break;case 3:d=function(a,d,B){return m in a||b in a||c in a?f(d[m],d[b],d[c]):B};break;default:d=function(m,b,A){for(var c=!1,d=[],O=0,B;B=a[O];O++)c=c||B in m,d.push(b[B]);return c?f.apply(null,d):A}}d.args=
a;return d.calc=d}function W(){return J.apply(null,M(arguments).concat(function(){for(var a=[],f=arguments.length;0<f--;){if(null==arguments[f])return null;a.push(arguments[f])}return a.join("-")}))}function Y(a,f){var m=["has"],b=[P],c=[],d;for(d in a)if(P.call(a,d)){var aa="v"+c.length,k="f"+c.length,p=a[d];m.push(aa,k);b.push(p,f[d]);c.push('"'+d+'":has.call(data,"'+d+'")?'+k+'(data["'+d+'"],'+aa+"):"+aa+("function"==typeof p?"(data)":""))}c=c.sort().join(",");(d=ia[c])||(d=ia[c]=new Function(m,
"return function(data){return {"+c+"};};"));return d.apply(null,b)}function u(a,f){if(!Array.isArray(a))return null;if(!Array.isArray(f)||a.length!=f.length)return a||null;for(var m=0;m<a.length;m++)if(a[m]!==f[m])return a;return f}function q(a,f,m){a.aliases[f]=f;m="string"==typeof m||Array.isArray(m)||"function"==typeof m&&m.calc!==m?{type:m}:e.object.slice(m);if("type"in m){"string"==typeof m.type&&(m.type=R(m.type,a.fields,f));if(Array.isArray(m.type)){var b=m.type.slice();1==b.length?(m.type=
e.fn.$const(b[0]),m.defValue=b[0]):(m.type=function(a,f){return-1!=b.indexOf(a)?a:f},m.defValue=-1!=b.indexOf(m.defValue)?m.defValue:b[0])}m.type===Array&&(m.type=u);"function"!=typeof m.type&&(m.type=L)}var c=m.type||L;-1!=[S,l,z,ea].indexOf(c)&&(m.id=!0);m.id&&(a.index||(a.index=new V(String)),a.idFields[f]=!0,a.idField||a.compositeKey?(a.idField=null,a.compositeKey=W.apply(null,n(a.idFields))):a.idField=f);m.calc?(t(a,f,m.calc),a.fields[f]=ja):a.fields[f]=c;a.defaults[f]="defValue"in m?m.defValue:
c();ca[f]||(ca[f]={destroy:function(){this.set(f,null)}})}function g(a,f,m){!1!=m in a.fields&&(f in a.aliases||(a.aliases[f]=m))}function t(a,f,m){a.calcs||(a.calcs=[]);var b=a.calcs,c=a.deps,d=m.args||[],aa={args:d,wrapper:m},k=a.calcs.length,p=0;if(d)for(var l=0,la;la=b[l];l++)-1!=d.indexOf(la.key)&&(p=l+1);if(f){aa.key=f;for(l=0;la=b[l];l++)if(-1!=la.args.indexOf(f)){k=l;break}if(p>k)return;a.idField&&f==a.idField&&(a.compositeKey=m);c[f]=d.reduce(function(a,f){for(var m=c[f]||[f],b=0;b<m.length;b++)e.array.add(a,
m[b]);return a},[]);for(var g in c)a=c[g].indexOf(f),-1!=a&&Array.prototype.splice.apply(c[g],[a,1].concat(c[f]))}else k=p;b.splice(Math.min(k,p),0,aa)}function Q(a){return function(f){return f&&this.modified&&a in this.modified?this.modified[a]:this.data[a]}}function r(a){return function(f,m){return this.set(a,f,m)}}e.require("./1.js");e.require("./0.js");e.require("./3.js");var D=this.path,y=e.Class,P=Object.prototype.hasOwnProperty,n=e.object.keys,s=e.object.extend,L=e.fn.$self,M=e.array.from,
F=e.event.Emitter;h=e.event.create;var T=e.data.Object,N=e.data.Slot,a=e.data.Dataset;C=e.data.dataset.Subset;var b=e.data.dataset.Split,d={},k=[],p={string:!0,number:!0},S=function(a){return isNaN(a)?null:Number(a)},l=function(a){return isNaN(a)?null:Number(a)},z=function(a){return isNaN(a)?null:parseInt(a,10)},ea=function(a){return null==a?null:String(a)},ba={},U={},X={},V=y(null,{className:D+".Index",items:null,fn:String,init:function(a){this.items={};"function"==typeof a&&(this.fn=a)},calcWrapper:function(a,
f){var m=this.fn(a,f);if(m!==f&&P.call(this.items,m))throw 144;return m},get:function(a,f){var m=P.call(this.items,a)&&this.items[a];if(m&&(!f||m.entityType===f))return m},add:function(a,f){var m=P.call(this.items,a)&&this.items[a];if(f&&(!m||m===f))return this.items[a]=f,!0},remove:function(a,f){if(this.items[a]===f)return delete this.items[a],!0},destroy:function(){this.items=null}});I=function(a,f){return function(m){return a.prototype[f].call(this,m&&m.map(this.wrapper))}};G=function(a,f){return function(){this.name||
(this.name=v(f));a.prototype.init.call(this)}};H=function(b){return function(f){var m=e.object.slice(this.items_),b=[];if(f){a.setAccumulateState(!0);for(var c=0;c<f.length;c++){var d=this.wrapper(f[c]);d&&(m[d.basisObjectId]=!1)}a.setAccumulateState(!1)}for(var aa in this.items_)!1==aa in m&&b.push(this.items_[aa]);a.setAccumulateState(!0);for(aa in m)m[aa]&&m[aa].destroy();a.setAccumulateState(!1);return b.length?b:null}};var da=y(a,{className:D+".EntitySet",name:null,wrapper:L,init:G(a,"EntitySet"),
sync:H(a),set:I(a,"set"),add:I(a,"add"),remove:I(a,"remove"),destroy:function(){a.prototype.destroy.call(this);this.wrapper=null}}),fa=y(da,{className:D+".ReadOnlyEntitySet",set:e.fn.$false,add:e.fn.$false,remove:e.fn.$false,clear:e.fn.$false});C=y(C,{className:D+".EntityCollection",name:null,init:G(C,"EntityCollection"),sync:H(C)});G=y(b,{className:D+".EntityGrouping",name:null,subsetClass:fa,init:G(b,"EntityGrouping"),sync:H(b),getSubset:function(a,f){var m=b.prototype.getSubset.call(this,a,f);
m&&m.dataset&&(m.dataset.wrapper=this.wrapper);return m}});var c=function(b,f){if(this instanceof c){b||(b=L);if(!f||U[f])f=v("UntitledEntitySetType");var m=new ha({entitySetClass:{wrapper:b}}),d=m.entitySetClass,O=function(f,b){return null!=f?(!1==b instanceof da&&(b=m.createEntitySet()),b.set(f instanceof a?f.getItems():M(f)),b):null};"string"==typeof b&&(d.prototype.wrapper=R(b,d.prototype,"wrapper"));E(f,O);s(O,{type:m,typeName:f,toString:function(){return this.typeName+"()"},entitySetType:m,
extend:function(){return d.extend.apply(d,arguments)},extendClass:function(){d.extend.apply(d,arguments);return O},reader:function(a){if(Array.isArray(a)){var f=d.prototype.wrapper;return a.map(f.reader||f)}return a},extendReader:function(a){var f=O.reader;O.reader=function(b){Array.isArray(b)&&a(b);return f(b)}}});return O}},ha=y(null,{className:D+".EntitySetConstructor",entitySetClass:da,extendConstructor_:!0,createEntitySet:function(){return new this.entitySetClass}}),x=function(a){if(this instanceof
x){var f;f=a.singleton?function(a){var f=b.get();f?a&&f.update(a):f=new c(a||{});return f}:function(a,f){if(null!=a){if(a===f||a.entityType===b)return a;var d,k=b.idField;if(p[typeof a]){if(!k)return;if(f=b.index.get(a,b))return f;d=a;a={};a[k]=d}else b.compositeKey?d=b.compositeKey(a,a):k&&(d=a[k]),null!=d&&(f=b.index.get(d,b));f&&f.entityType===b?f.update(a):f=new c(a);return f}};var b=new $(a||{},f),c=b.entityClass;E(b.name,f);s(f,{all:b.all,type:b,typeName:b.name,entityType:b,toString:function(){return this.typeName+
"()"},reader:function(a){return b.reader(a)},get:function(a){return b.get(a)},getSlot:function(a,f){return b.getSlot(a,f)},extend:function(){return c.extend.apply(c,arguments)},extendClass:function(){return c.extend.apply(c,arguments)},extendReader:function(a){var b=f.reader;f.reader=function(f){f&&"object"==typeof f&&a(f);return b(f)}}});return f}},ca={},ia={},ja=function(a,f){return f},$=y(null,{className:D+".EntityType",wrapper:null,all:null,fields:null,idFields:null,defaults:null,aliases:null,
slots:null,singleton:!1,index:null,entityClass:null,init:function(a,f){this.name=a.name;if(!this.name||U[this.name])this.name=v("UntitledEntityType");this.fields={};this.deps={};this.idFields={};this.defaults={};this.aliases={};this.slots={};var b=a.index;b&&b instanceof V&&(this.index=b);this.wrapper=f;if(!1=="all"in a||a.all||a.singleton)this.all=new fa(e.object.complete({wrapper:f},a.all));if(this.singleton=!!a.singleton){var c;this.get=function(){return c};this.all.addHandler({itemsChanged:function(a,
f){c=f.inserted?f.inserted[0]:null}},this)}for(var d in a.fields)q(this,d,a.fields[d]);for(d in a.aliases)g(this,d,a.aliases[d]);a.constrains&&a.constrains.forEach(function(a){t(this,null,a)},this);b={};for(d in this.defaults)b[d]=void 0;this.entityClass=ka(this,this.all,this.fields,this.slots);this.entityClass.extend({entityType:this,type:f,typeName:this.name,state:a.state||this.entityClass.prototype.state,generateData:Y(this.defaults,this.fields),initDelta:b});for(var B in this.fields)this.entityClass.prototype["get_"+
B]=Q(B),this.fields[B]!==ja&&(this.entityClass.prototype["set_"+B]=r(B));k.push(this)},reader:function(a){var f={};if(p[typeof a])return this.idField?a:null;if(!a||null==a)return null;for(var b in a){var c=this.aliases[b];if(c){var d=this.fields[c].reader;f[c]=d?d(a[b]):a[b]}}return f},get:function(a){a=this.getId(a);if(null!=a)return this.index.get(a,this)},getId:function(a){if((this.idField||this.compositeKey)&&null!=a){if(p[typeof a])return a;if(a&&a.entityType===this)return a.__id__;a instanceof
T&&(a=a.data);return this.compositeKey?this.compositeKey(a,a):a[this.idField]}},getSlot:function(a){var f=this.getId(a);if(null!=f){var b=P.call(this.slots,f)&&this.slots[f];b||(p[typeof a]&&(b={},this.idField&&!this.compositeKey&&(b[this.idField]=a),a=b),b=this.slots[f]=new N({delegate:this.get(f)||null,data:a}));return b}}}),ga=y(T,{className:D+".BaseEntity",target:!0,setDelegate:function(){},modified:null,emit_rollbackUpdate:h("rollbackUpdate")}),ka=function(a,f,b,c){function k(f,b,m){var c=a.calcs,
d=f.data,A=!1,O=f.__id__,p;try{if(c)for(var e=0,l;l=c[e];e++){var g=l.key,z=d[g],h=l.wrapper(b,d,z);g&&h!==z&&(d[g]=h,b[g]=z,A=!0)}p=a.compositeKey?a.compositeKey(b,d,O):a.idField&&a.idField in b?d[a.idField]:O;p!==O&&a.index.calcWrapper(p,O)}catch(S){A=!1;p=O;for(g in b)f.data[g]=b[g];if(m&&!f.modified)for(g in m){f.modified=m;break}}p!==O&&(f.__id__=p,B(f,O,p));return A}function B(f,b,m){var d=a.index;null!=b&&(d.remove(b,f),P.call(c,b)&&c[b].setDelegate());null!=m&&(d.add(m,f),P.call(c,m)&&c[m].setDelegate(f))}
return y(ga,{className:D+".Entity",extendConstructor_:!1,fieldHandlers_:null,init:function(a){this.delegate=null;this.data=this.generateData(a);ga.prototype.init.call(this);for(var b in this.data)(a=this.data[b])&&a!==this&&a instanceof F&&(a.addHandler(ca[b],this),this.fieldHandlers_||(this.fieldHandlers_={}),this.fieldHandlers_[b]=!0);k(this,this.initDelta);f&&f.emit_itemsChanged({inserted:[this]})},toString:function(){return"[object "+this.constructor.className+"("+this.entityType.name+")]"},getId:function(){return this.__id__},
get:function(a,f){return f&&this.modified&&a in this.modified?this.modified[a]:this.data[a]},set:function(f,c,d,A){var p=b[f];if(!p)return!1;var B,e=this.modified;p===u&&e&&f in e&&(c=u(c,e[f]));c=p(c,this.data[f]);p=this.data[f];if(c===p||c&&p&&c.constructor===Date&&p.constructor===Date&&+c===+p)!d&&e&&f in e&&(B={rollback:{key:f,value:e[f]}},delete e[f],n(e).length||(this.modified=null));else a:{B={};if(!a.idFields[f])if(d)e||(this.modified=e={}),!1===f in e?(B.rollback={key:f,value:void 0},e[f]=
p):e[f]===c&&(B.rollback={key:f,value:c},delete e[f],n(e).length||(this.modified=null));else if(e&&f in e)if(e[f]!==c){B.rollback={key:f,value:e[f]};e[f]=c;break a}else return!1;this.data[f]=c;this.fieldHandlers_&&this.fieldHandlers_[f]&&(p.removeHandler(ca[f],this),this.fieldHandlers_[f]=!1);c&&c!==this&&c instanceof F&&(c.addHandler(ca[f],this),this.fieldHandlers_||(this.fieldHandlers_={}),this.fieldHandlers_[f]=!0);B.key=f;B.value=p;B.delta={};B.delta[f]=p}if(!A&&B){f=B.key;d=B.delta||{};var l;
B.rollback&&(l={},l[B.rollback.key]=B.rollback.value);k(this,d,l)&&(f=!0);f&&(this.emit_update(d),B.delta=d);l&&this.emit_rollbackUpdate(l)}return B||!1},update:function(a,f){var b=!1,m={};if(a){var c,d={},A,B;for(B in a)if(A=this.set(B,a[B],f,!0))A.key&&(b=!0,m[A.key]=A.value),A.rollback&&(c=!0,d[A.rollback.key]=A.rollback.value);k(this,m,d)&&(b=!0);b&&this.emit_update(m);c&&this.emit_rollbackUpdate(d)}return b?m:!1},generateData:function(){return{}},reset:function(){this.update(this.generateData({}))},
clear:function(){var a={},f;for(f in this.data)a[f]=void 0;return this.update(a)},commit:function(a){var f=this.modified;this.modified=null;a&&this.update(a);f&&this.emit_rollbackUpdate(f)},rollback:function(f){var b=this.modified;b&&f&&(Array.isArray(f)||(f=[f]),b=e.object.slice(b,f.reduce(function(f,b){return f.concat(a.deps[b]||b)},[])));this.update(b,!0)},destroy:function(){if(this.fieldHandlers_){for(var a in this.fieldHandlers_)this.fieldHandlers_[a]&&this.data[a].removeHandler(ca[a],this);
this.fieldHandlers_=null}null!=this.__id__&&B(this,this.__id__,null);T.prototype.destroy.call(this);f&&f.emit_itemsChanged({deleted:[this]});this.data=d;this.modified=null}})};w.exports={isEntity:function(a){return a&&a instanceof ga},createType:function(a,f){var b=a||{};"string"==typeof a?b={name:b,fields:f||{}}:f&&(b=e.object.merge(b,{fields:f}));return new x(b)},createSetType:function(a,f){return 1<arguments.length?new c(f,a):new c(a)},validate:function(){for(var a in X)e.dev.warn(D+": type `"+
a+"` is not defined, but used by "+X[a].length+" type(s)")},getTypeByName:function(a){return U[a]},get:function(a,f){var b=U[a];if(b)return b.get(f)},NumericId:S,NumberId:l,IntId:z,StringId:ea,Index:V,CalculateField:J,calc:J,EntityType:x,Entity:ka,BaseEntity:ga,EntitySetType:c,EntitySet:da,ReadOnlyEntitySet:fa,Collection:C,Grouping:G}},"3.js":function(h,w,e,G,H,C,I,Z){function v(a,b){var d={},k;a&&a.length&&(k=d.inserted=a);b&&b.length&&(k=d.deleted=b);if(k)return d}function E(a,b){return function k(b){if(!b)return null;
if(b.__extend__)return b;"string"==typeof b||Array.isArray(b)||(b="object"==typeof b?e.object.keys(b):null);return Y(e.event.createHandler(b,a),{__extend__:k})}(b)}function R(a,b,d,k){return new n(Y({keyGetter:b,itemClass:d,create:function(a,b){var d=n.prototype.create.call(this,a,b);d.setDataset(new k({ruleValue:a}));return d}},a))}function J(a,b){if(!a.length)return 0;var d=b.value,k=b.object.basisObjectId,e,g,l,z,h=0,n=a.length-1;do if(l=h+n>>1,z=a[l],e=z.value,d<e)n=l-1;else if(d>e)h=l+1;else if(g=
z.object.basisObjectId,k<g)n=l-1;else if(k>g)h=l+1;else return l;while(h<=n);return l+(e==d?g<k:e<d)}function W(a,b){return+(a.value>b.value)||-(a.value<b.value)||a.object.basisObjectId-b.object.basisObjectId}e.require("./1.js");e.require("./0.js");C=this.path;I=e.Class;var Y=e.object.extend,u=e.object.values,q=e.getter,g=e.fn.$self,t=e.fn.$true,Q=e.fn.$false,r=e.array.from,D=e.event.create,y=e.data.SUBSCRIPTION,P=e.data.Object,n=e.data.KeyObjectMap,s=e.data.AbstractDataset,L=e.data.Dataset;Z=e.data.DatasetWrapper;
y.add("SOURCE",{sourceChanged:function(a,b){b&&y.unlink("source",a,b);a.source&&y.link("source",a,a.source)},sourcesChanged:function(a,b){var d;if(d=b.inserted)for(var k=0;d[k];k++)y.link("source",a,d[k]);if(d=b.deleted)for(k=0;d[k];k++)y.unlink("source",a,d[k])}},function(a,b){for(var d=b.sources||(b.source?[b.source]:[]),k=0,e;e=d[k++];)a("source",b,e)});y.addProperty("minuend");y.addProperty("subtrahend");var M=I(s,{className:C+".Merge",subscribeTo:y.SOURCE,emit_sourcesChanged:D("sourcesChanged",
"delta"),sources:null,rule:function(a,b){return 0<a},listen:{source:{itemsChanged:function(a,b){var d=this.members_,k={},e,g;if(b.inserted)for(var l=0;e=b.inserted[l];l++)g=e.basisObjectId,d[g]?d[g].count++:d[g]={count:1,object:e},k[g]=d[g];if(b.deleted)for(l=0;e=b.deleted[l];l++)g=e.basisObjectId,k[g]=d[g],d[g].count--;this.applyRule(k)},destroy:function(a){this.removeSource(a)}}},init:function(){s.prototype.init.call(this);var a=this.sources;this.sources=[];a&&a.forEach(this.addSource,this)},setRule:function(a){"function"!=
typeof a&&(a=M.UNION);this.rule!==a&&(this.rule=a,this.applyRule())},applyRule:function(a){var b=this.members_,d=this.rule,k=this.sources.length,e=[],g=[],l,z;a||(a=b);for(var h in a)a=b[h],l=k&&a.count&&d(a.count,k),l!=!!this.items_[h]&&(l?e:g).push(a.object),0==a.count&&delete b[h];(z=v(e,g))&&this.emit_itemsChanged(z);return z},addSource:function(a){if(a instanceof s&&e.array.add(this.sources,a)){this.listen.source&&a.addHandler(this.listen.source,this);var b=this.members_,d;for(d in a.items_)b[d]?
b[d].count++:b[d]={count:1,object:a.items_[d]};this.applyRule();this.emit_sourcesChanged({inserted:[a]});return!0}},removeSource:function(a){if(e.array.remove(this.sources,a)){this.listen.source&&a.removeHandler(this.listen.source,this);var b=this.members_,d;for(d in a.items_)b[d].count--;this.applyRule();this.emit_sourcesChanged({deleted:[a]});return!0}},setSources:function(a){for(var b=r(this.sources),d=0,k;k=a[d];d++)k instanceof s&&(e.array.remove(b,k)||this.addSource(k));b.forEach(this.removeSource,
this)},clear:function(){r(this.sources).forEach(this.removeSource,this)},destroy:function(){s.prototype.destroy.call(this);this.sources=null}});M.UNION=M.prototype.rule;M.INTERSECTION=function(a,b){return a==b};M.DIFFERENCE=function(a,b){return 1==a};M.MORE_THAN_ONE_INCLUDE=function(a,b){return 1==b||1<a};M.AT_LEAST_ONE_EXCLUDE=function(a,b){return 1==b||a<b};var F=function(a){return!this.has(a)};h=I(s,{className:C+".Subtract",subscribeTo:y.MINUEND+y.SUBTRAHEND,minuend:null,emit_minuendChanged:D("minuendChanged",
"oldMinuend"),subtrahend:null,emit_subtrahendChanged:D("subtrahendChanged","oldSubtrahend"),listen:{minuend:{itemsChanged:function(a,b){if(this.subtrahend){var d=v(b.inserted&&b.inserted.filter(F,this.subtrahend),b.deleted&&b.deleted.filter(this.has,this));d&&this.emit_itemsChanged(d)}},destroy:function(){this.setOperands(null,this.subtrahend)}},subtrahend:{itemsChanged:function(a,b){if(this.minuend){var d=v(b.deleted&&b.deleted.filter(F,this),b.inserted&&b.inserted.filter(this.has,this));d&&this.emit_itemsChanged(d)}},
destroy:function(){this.setOperands(this.minuend,null)}}},init:function(){s.prototype.init.call(this);var a=this.minuend,b=this.subtrahend;this.subtrahend=this.minuend=null;(a||b)&&this.setOperands(a,b)},setOperands:function(a,b){var d,k=!1;!1==a instanceof s&&(a=null);!1==b instanceof s&&(b=null);var e=this.minuend,g=this.subtrahend;if(e!==a){k=!0;this.minuend=a;var l=this.listen.minuend;l&&(e&&e.removeHandler(l,this),a&&a.addHandler(l,this));this.emit_minuendChanged(e)}if(g!==b){k=!0;this.subtrahend=
b;if(l=this.listen.subtrahend)g&&g.removeHandler(l,this),b&&b.addHandler(l,this);this.emit_subtrahendChanged(g)}if(!k)return!1;if(a&&b){var k=[],e=[],h;for(h in this.items_)a.items_[h]&&!b.items_[h]||k.push(this.items_[h]);for(h in a.items_)this.items_[h]||b.items_[h]||e.push(a.items_[h]);(d=v(e,k))&&this.emit_itemsChanged(d)}else this.itemCount&&this.emit_itemsChanged(d={deleted:this.getItems()});return d},setMinuend:function(a){return this.setOperands(a,this.subtrahend)},setSubtrahend:function(a){return this.setOperands(this.minuend,
a)},clear:function(){this.setOperands()}});var T=I(s,{className:C+".SourceDataset",subscribeTo:y.SOURCE,source:null,emit_sourceChanged:D("sourceChanged","oldSource"),sourceAdapter_:null,sourceMap_:null,listen:{source:{destroy:function(){this.sourceAdapter_||this.setSource()}}},init:function(){this.sourceMap_={};s.prototype.init.call(this);var a=this.source;a&&(this.source=null,this.setSource(a))},setSource:function(a){a=e.data.resolveDataset(this,this.setSource,a,"sourceAdapter_");if(this.source!==
a){var b=this.source,d=this.listen.source;this.source=a;if(d){var k=d.itemsChanged;b&&(b.removeHandler(d,this),k&&k.call(this,b,{deleted:b.getItems()}));a&&(a.addHandler(d,this),k&&k.call(this,a,{inserted:a.getItems()}))}this.emit_sourceChanged(b)}},clear:function(){this.setSource()},destroy:function(){s.prototype.destroy.call(this);this.sourceMap_=null}}),N=I(T,{className:C+".MapFilter",map:g,filter:Q,rule:q(t),ruleEvents:E(function(a){var b=this.map?this.map(a):object;if(!1==b instanceof P||this.filter(b))b=
null;var d=this.sourceMap_[a.basisObjectId],k=d.member;if(k!==b){var e=this.members_,g,l,h;d.member=b;k&&(d=k.basisObjectId,this.removeMemberRef&&this.removeMemberRef(k,a),0==--e[d]&&(delete e[d],h=[k]));b&&(k=b.basisObjectId,this.addMemberRef&&this.addMemberRef(b,a),e[k]?e[k]++:(e[k]=1,l=[b]));(g=v(l,h))&&this.emit_itemsChanged(g)}},"update"),addMemberRef:null,removeMemberRef:null,listen:{source:{itemsChanged:function(a,b){var d=this.sourceMap_,k=this.members_,e=[],g=[],l,h,n,s=this.ruleEvents;L.setAccumulateState(!0);
if(b.inserted)for(var r=0;l=b.inserted[r];r++){n=this.map?this.map(l):l;if(!1==n instanceof P||this.filter(n))n=null;s&&l.addHandler(s,this);d[l.basisObjectId]={sourceObject:l,member:n};n&&(h=n.basisObjectId,k[h]?k[h]++:(k[h]=1,e.push(n)),this.addMemberRef&&this.addMemberRef(n,l))}if(b.deleted)for(r=0;l=b.deleted[r];r++)h=l.basisObjectId,n=d[h].member,s&&l.removeHandler(s,this),delete d[h],n&&(h=n.basisObjectId,0==--k[h]&&(delete k[h],g.push(n)),this.removeMemberRef&&this.removeMemberRef(n,l));L.setAccumulateState(!1);
(b=v(e,g))&&this.emit_itemsChanged(b)}}},setMap:function(a){"function"!=typeof a&&(a=g);if(this.map!==a)return this.map=a,this.applyRule()},setFilter:function(a){"function"!=typeof a&&(a=Q);if(this.filter!==a)return this.filter=a,this.applyRule()},setRule:function(a){"function"!=typeof a&&(a=t);if(this.rule!==a)return this.rule=a,this.applyRule()},applyRule:function(){var a=this.sourceMap_,b=this.members_,d,k,e,g,l,h=[],n=[],r,s;for(s in a){l=a[s];g=l.sourceObject;d=l.member;k=this.map?this.map(g):
g;if(!1==k instanceof P||this.filter(k))k=null;d!=k&&(l.member=k,d&&(e=d.basisObjectId,this.removeMemberRef&&this.removeMemberRef(d,g),b[e]--),k&&(d=k.basisObjectId,this.addMemberRef&&this.addMemberRef(k,g),d in b?b[d]++:(b[d]=1,h.push(k))))}for(e in this.items_)0==b[e]&&(delete b[e],n.push(this.items_[e]));(r=v(h,n))&&this.emit_itemsChanged(r);return r}});G=I(N,{className:C+".Subset",filter:function(a){return!this.rule(a)}});H=I(N,{className:C+".Split",subsetClass:s,subsetWrapperClass:Z,keyMap:null,
map:function(a){return this.keyMap.resolve(a)},setRule:function(a){"function"!=typeof a&&(a=t);if(this.rule!==a)return this.rule=a,this.keyMap.keyGetter=a,this.applyRule()},addMemberRef:function(a,b){a.dataset.emit_itemsChanged({inserted:[b]})},removeMemberRef:function(a,b){a.dataset.emit_itemsChanged({deleted:[b]})},init:function(){this.keyMap&&!1!=this.keyMap instanceof n||(this.keyMap=R(this.keyMap,this.rule,this.subsetWrapperClass,this.subsetClass));N.prototype.init.call(this)},getSubset:function(a,
b){return this.keyMap.get(a,b)},destroy:function(){N.prototype.destroy.call(this);this.keyMap.destroy();this.keyMap=null}});D=I(T,{className:C+".Slice",rule:q(t),ruleEvents:E(function(a){var b=this.sourceMap_[a.basisObjectId];a=this.rule(a);var d=this.index_;if(a!==b.value){var k=J(d,b),e=d[k-1],g=d[k+1];b.value=a;if(e&&(e.value>a||e.value==a&&e.object.basisObjectId>b.object.basisObjectId)||g&&(g.value<a||g.value==a&&g.object.basisObjectId<b.object.basisObjectId))d.splice(k,1),d.splice(J(d,b),0,b),
this.applyRule()}},"update"),index_:null,orderDesc:!1,offset:0,limit:10,listen:{source:{itemsChanged:function(a,b){var d=this.sourceMap_,e=this.index_,g=this.ruleEvents,h=!1,l=!1,n,r=b.inserted,s=b.deleted;if(s){s.length>e.length-s.length&&(h=!0,l=s.length!=e.length,e.length=0);for(var t=0,q;q=s[t];t++)h||(n=d[q.basisObjectId],e.splice(J(e,n),1)),delete d[q.basisObjectId],g&&q.removeHandler(g,this);if(l)for(var u in d)n=d[u],e.splice(J(e,n),0,n)}if(r){l=!e.length;for(t=0;q=r[t];t++)n={object:q,value:this.rule(q)},
d[q.basisObjectId]=n,l?e.push(n):e.splice(J(e,n),0,n),g&&q.addHandler(g,this);l&&e.sort(W)}this.applyRule()}}},emit_rangeChanged:D("rangeChanged","oldOffset","oldLimit"),init:function(){this.index_=[];T.prototype.init.call(this)},setRange:function(a,b){var d=this.offset,e=this.limit,g=!1;if(d!=a||e!=b)this.offset=a,this.limit=b,g=this.applyRule(),this.emit_rangeChanged(d,e);return g},setOffset:function(a){return this.setRange(a,this.limit)},setLimit:function(a){return this.setRange(this.offset,a)},
setRule:function(a,b){a=q(a);this.orderDesc=!!b;if(this.rule!=a){for(var d=this.index_,e=0;e<d.length;e++)d[e].value=a(d[e].object);this.rule=a;d.sort(W)}return this.applyRule()},applyRule:function(){var a=this.offset,b=a+this.limit;this.orderDesc&&(a=this.index_.length-b,b=a+this.limit);for(var d=e.object.slice(this.members_),a=this.index_.slice(Math.max(0,a),Math.max(0,b)),b=[],k,g=0,h;h=a[g];g++){var l=h.object.basisObjectId;d[l]?delete d[l]:(b.push(h.object),this.members_[l]=h.object)}for(l in d)delete this.members_[l];
(k=v(b,u(d)))&&this.emit_itemsChanged(k);return k},destroy:function(){T.prototype.destroy.call(this);this.index_=null}});C=I(T,{className:C+".Cloud",subsetClass:s,subsetWrapperClass:Z,rule:q(Q),ruleEvents:E(function(a){var b=this.sourceMap_,d=this.members_,e=a.basisObjectId,g=b[e].list,b=b[e].list={},e=this.rule(a),h,l=[],n=[],s;if(Array.isArray(e))for(var r=0;r<e.length;r++)(s=this.keyMap.get(e[r],!0))&&!s.has(a)&&(q=s.basisObjectId,b[q]=s,g[q]||(s.dataset.emit_itemsChanged({inserted:[a]}),d[q]?
d[q]++:(l.push(s),d[q]=1)));for(var q in g)b[q]||(s=g[q],s.dataset.emit_itemsChanged({deleted:[a]}),--d[q]||(delete d[q],n.push(s)));(h=v(l,n))&&this.emit_itemsChanged(h)},"update"),keyMap:null,map:g,listen:{source:{itemsChanged:function(a,b){var d=this.sourceMap_,e=this.members_,g=this.ruleEvents,h,l,n,s=[],r=[];L.setAccumulateState(!0);if(h=b.inserted)for(var q=0,t;t=h[q];q++){var u=this.rule(t),y={object:t,list:{}};d[t.basisObjectId]=y;if(Array.isArray(u))for(var E=0,c={};E<u.length;E++)(l=this.keyMap.get(u[E],
!0))&&!c[l.basisObjectId]&&(n=l.basisObjectId,c[n]=!0,y.list[n]=l,l.dataset.emit_itemsChanged({inserted:[t]}),e[n]?e[n]++:(s.push(l),e[n]=1));g&&t.addHandler(g,this)}if(h=b.deleted)for(q=0;t=h[q];q++){l=t.basisObjectId;u=d[l].list;delete d[l];for(n in u)l=u[n],l.dataset.emit_itemsChanged({deleted:[t]}),--e[n]||(delete e[n],r.push(l));g&&t.removeHandler(g,this)}L.setAccumulateState(!1);(b=v(s,r))&&this.emit_itemsChanged(b)}}},init:function(){this.keyMap&&!1!=this.keyMap instanceof n||(this.keyMap=
R(this.keyMap,this.rule,this.subsetWrapperClass,this.subsetClass));T.prototype.init.call(this)},getSubset:function(a,b){return this.keyMap.get(a,b)},destroy:function(){T.prototype.destroy.call(this);this.keyMap.destroy();this.keyMap=null}});w.exports={createRuleEvents:E,Merge:M,Subtract:h,SourceDataset:T,MapFilter:N,Subset:G,Split:H,Slice:D,Cloud:C}},"4.js":function(h,w,e,G,H,C,I,Z){function v(e){if(0<e.basisGetterId_){var h="getter(";if("string"==typeof e.base)h+='"'+e.base.replace(/"/g,'\\"')+'"';
else if(e.mod)h+=v(e.base);else return v(e.base);e.mod&&(h="string"==typeof e.mod?h+(', "'+e.mod.replace(/"/g,'\\"')+'"'):h+(", "+v(e.mod)));return h+")"}return Function.prototype.toString.call(e)}w.exports={fn:function(h){var w=Function.prototype.toString.call(h),J=w.match(/^\s*function(\s+\S+)?\s*\(((?:\s*\/\*[^*]*\*\/)*\s*\S+(?:\s*,(?:\s*\/\*[^*]*\*\/)*\s*\S+(?:\s*\/\*[^*]*\*\/)*)*)\)/),W=w.replace(/^\s*\(?\s*function[^(]*\([^\)]*\)[^{]*\{|\}\s*\)?\s*$/g,"");h=v(h);var Y=(J&&J[2]||"").trim().replace(/\s*,\s*/g,
", ").replace(/\s*\/\*\*\/$/,"");J||e.dev.log("Function parse error: "+w);return{source:w,name:(J&&J[1]||"anonymous").trim(),fullname:name+"("+Y+")",args:Y,body:W,getter:h!=w?h:!1}}}},"5.js":function(h,w,e,G,H,C,I,Z){var v="undefined"!==typeof performance?performance:Date,E="webkitNow"in v?"webkitNow":"now";w.exports={time:function(e){return arguments.length?parseInt(v[E]()-e):v[E]()},test:function(e,h){for(var v=this.time(),w=0;w<e;w++)h(w);return this.time(v)}}},"6.js":function(h,w,e,G,H,C,I,Z){var v=
e.number.lead,E=e.string.repeat,R={};h={add:function(e,h){R[e]=h}};h.add("text",e.array);h.add("js",function(){var e=RegExp("\\b(break|case|catch|continue|default|delete|do|else|false|for|function|if|in|instanceof|new|null|return|super|switch|this|throw|true|try|typeof|var|while|with)\\b","g");return function(h){function v(g,q,r,n){t!=q&&u.push(h.substring(t,q).replace(e,'<span class="token-keyword">$1</span>'));t=r+1;g&&u.push('<span class="token-'+g+'">'+h.substring(q,r+1)+"</span>"+(n||""))}for(var u=
[],q=h.split(""),g,t=0,w,r=0;r<q.length;r++)if("'"==q[r]||'"'==q[r])for(w=q[r],g=r;++r<q.length;){"\\"==q[r]&&("\n"==q[r+1]?(v("string",g,r),g=++r+1):r+=2);if(q[r]==w){v("string",g,r);break}if("\n"==q[r])break}else if("/"==q[r])if(g=r,r++,"/"==q[r]){for(;++r<q.length&&"\n"!=q[r];);v("comment",g,r-1)}else if("*"==q[r])for(;++r<q.length;)if("*"==q[r]&&"/"==q[r+1]){v("comment",g,++r);break}else"\n"==q[r]&&(v("comment",g,r-1,"\n"),t=g=r+1);v(null,h.length);return u}}());h.add("css",function(){var e=RegExp("(^|[^a-z0-9-])((?:-webkit-|-o-|-ms-|-moz-|-khtml-)?(?:transition|transition-delay|transition-duration|transition-property|transition-timing-function|transform|transform-origin|background-origin|background-clip|background-size|border-image|border-image-outset|border-image-repeat|border-image-slice|border-image-source|border-image-width|border-radius|border-top-right-radius|border-bottom-right-radius|border-bottom-left-radius|border-top-left-radius|box-decoration-break|box-shadow|column-count|column-fill|column-gap|column-rule|column-rule-color|column-rule-style|column-rule-width|columns|column-span|column-width)|(?:azimuth|background-attachment|background-color|background-image|background-position|background-repeat|background|border-collapse|border-color|border-spacing|border-style|border-top|border-right|border-bottom|border-left|border-top-color|border-right-color|border-bottom-color|border-left-color|border-top-style|border-right-style|border-bottom-style|border-left-style|border-top-width|border-right-width|border-bottom-width|border-left-width|border-width|border|bottom|caption-side|clear|clip|color|content|counter-increment|counter-reset|cue-after|cue-before|cue|cursor|direction|display|elevation|empty-cells|float|font-family|font-size|font-style|font-variant|font-weight|font|height|left|letter-spacing|line-height|list-style-image|list-style-position|list-style-type|list-style|margin-right|margin-left|margin-top|margin-bottom|margin|max-height|max-width|min-height|min-width|orphans|outline-color|outline-style|outline-width|outline|overflow|padding-top|padding-right|padding-bottom|padding-left|padding|page-break-after|page-break-before|page-break-inside|pause-after|pause-before|pause|pitch-range|pitch|play-during|position|quotes|richness|right|speak-header|speak-numeral|speak-punctuation|speak|speech-rate|stress|table-layout|text-align|text-decoration|text-indent|text-transform|top|unicode-bidi|vertical-align|visibility|voice-family|volume|white-space|widows|width|word-spacing|z-index))(s|:|$)",
"gi"),h=RegExp("\\b(left-side|far-left|left|center-left|center-right|center|far-right|right-side|right|behind|leftwards|rightwards|inherit|scroll|fixed|transparent|none|repeat-x|repeat-y|repeat|no-repeat|collapse|separate|auto|top|bottom|both|open-quote|close-quote|no-open-quote|no-close-quote|crosshair|default|pointer|move|e-resize|ne-resize|nw-resize|n-resize|se-resize|sw-resize|s-resize|text|wait|help|ltr|rtl|inline|block|list-item|run-in|compact|marker|table|inline-table|table-row-group|table-header-group|table-footer-group|table-row|table-column-group|table-column|table-cell|table-caption|below|level|above|higher|lower|show|hide|caption|icon|menu|message-box|small-caption|status-bar|normal|wider|narrower|ultra-condensed|extra-condensed|condensed|semi-condensed|semi-expanded|expanded|extra-expanded|ultra-expanded|italic|oblique|small-caps|bold|bolder|lighter|inside|outside|disc|circle|square|decimal|decimal-leading-zero|lower-roman|upper-roman|lower-greek|lower-alpha|lower-latin|upper-alpha|upper-latin|hebrew|armenian|georgian|cjk-ideographic|hiragana|katakana|hiragana-iroha|katakana-iroha|crop|cross|invert|visible|hidden|always|avoid|x-low|low|medium|high|x-high|static|relative|absolute|portrait|landscape|spell-out|once|digits|continuous|code|x-slow|slow|fast|x-fast|faster|slower|justify|underline|overline|line-through|blink|capitalize|uppercase|lowercase|embed|bidi-override|baseline|sub|super|text-top|middle|text-bottom|silent|x-soft|soft|loud|x-loud|pre|nowrap|serif|sans-serif|cursive|fantasy|monospace|empty|string|strict|loose|char|true|false|dotted|dashed|solid|double|groove|ridge|inset|outset|larger|smaller|xx-small|x-small|small|large|x-large|xx-large|all|newspaper|distribute|distribute-all-lines|distribute-center-last|inter-word|inter-ideograph|inter-cluster|kashida|ideograph-alpha|ideograph-numeric|ideograph-parenthesis|ideograph-space|keep-all|break-all|break-word|lr-tb|tb-rl|thin|thick|inline-block|w-resize|hand|distribute-letter|distribute-space|whitespace|ignore)\\b",
"g");return function(v){function u(g,n,r,t){if(w!=n){var u=v.substring(w,n);D&&(u=y?u.replace(h,'<span class="token-value">$1</span>'):u.replace(e,'$1<span class="token-key">$2</span>$3'));q.push(u)}w=r+1;g&&q.push('<span class="token-'+g+'">'+v.substring(n,r+1)+"</span>"+(t||""))}for(var q=[],g=v.split(""),t=0,w=0,r,D=!1,y=!1,C=!1,n=0;n<g.length;n++)if("'"==g[n]||'"'==g[n])for(r=g[n],t=n;++n<g.length;){if(g[n]==r){u("string",t,n);break}if("\n"==g[n])break;"\\"==g[n]&&"\n"==g[n+1]&&(u("string",t,
n),t=++n+1)}else if("/"==g[n]){if(t=n,n++,"*"==g[n])for(;++n<g.length;)if("*"==g[n]&&"/"==g[n+1]){u("comment",t,++n);break}else"\n"==g[n]&&(u("comment",t,n-1,"\n"),w=t=n+1)}else"{"==g[n]?(D=!0,C=y=!1,t=n+1,u("",t,n)):"("==g[n]?y&&(C=!0):")"==g[n]?y&&(C=!1):":"==g[n]?D&&!C&&(t=n+1,u("",t,n),y=!0):";"==g[n]?D&&!C&&(t=n+1,u("",t,n),y=!1):"}"==g[n]&&(y=D=!1);u(null,v.length);return q}}());w.exports={highlight:function(e,h,w){w||(w={});e=(R[h]||R.text)(function(e){e=e.trimRight().replace(/\r\n|\n\r|\r/g,
"\n");w.keepFormat||(e=e.replace(/^(?:\s*[\n]+)+?([ \t]*)/,"$1"));e=e.replace(/\n[ \t]+/g,function(e){return e.replace(/\t/g,"  ")}).replace(/\n[ \t]+\n/g,"\n\n");if(!w.keepFormat){for(var g=1E3,h=e.split(/\n+/),q=Number(null!=e.match(/^function/));q<h.length;q++){var u=h[q].match(/^\s*/);u[0].length<g&&(g=u[0].length);if(0==g)break}0<g&&(e=e.replace(RegExp("(^|\\n) {"+g+"}","g"),"$1"))}return e=e.replace(RegExp("(^|\\n)( +)","g"),function(e,g,h){return g+E(" ",h.length)})}(e||"").replace(/</g,"&lt;")).join("").split("\n");
h=String(e.length).length;for(var u=[],q=w.noLineNumber?"":" hasLineNumber",g=0;g<e.length;g++)u.push('<div class="line '+(g%2?"odd":"even")+q+'"><span class="lineContent">'+(w.noLineNumber?"":'<input class="lineNumber" value="'+v(g+1,h)+'" type="none" unselectable="on" readonly="readonly" tabindex="-1" /><span class="over"></span>')+(e[g]+"\r\n")+"</span></div>");return u.join("")},useStyle:e.fn.runOnce(function(){e.resource("./0.css")().startUse()})}}};(function(h){function w(a,b){for(var c in b)a[c]=
b[c];return a}function e(a,b){for(var c in b)!1==c in a&&(a[c]=b[c]);return a}function G(a){var b=[],c;for(c in a)b.push(c);return b}function H(a,b){var c={};if(!b)return w(c,a);for(var d=0,e;e=b[d++];)e in a&&(c[e]=a[e]);return c}function C(){return u(arguments).reduce(w,{})}function I(a,b,c){var d=[],e;for(e in a)d.push(b.call(c,e,a[e]));return d}function Z(a){return a}function v(){}function E(a){var b=d[a.url];if(b)for(var c=0;c<b.length;c++)b[c](a.get(),a.url)}function R(a,b,c){try{return new Function(b,
c)}catch(d){D.error("Compilation error at "+a+("line"in d?":"+(d.line-1):"")+": "+d)}}function J(a){var b=a.split(".")[0],c=a.replace(/\./g,"/")+".js";!1==a in z&&(!1==b in ba&&(ba[b]=s.baseURI),b==a&&(ea[ba[b]+c]=b),z[a]=ba[b]+c);return z[a]}function W(a){a=a.split(".");var b;b=a[0];var c=l[b];c||(c=l[b]=new U(b),c.namespaces_={},c.namespaces_[b]=c,L.noConflict||(h[b]=c));for(var c=b=c,d=1,e;e=a[d];d++){if(!c[e]){var g=a.slice(0,d+1).join(".");c[e]=new U(g);b.namespaces_[g]=c[e]}c=c[e]}return l[a.join(".")]=
c}function Y(a,b){if(L.extProto)for(var c in b)a.prototype[c]=function(a,f){return function(){var f=[this];Array.prototype.push.apply(f,arguments);return b[a].apply(b,f)}}(c,a.name||a.toString().match(/^\s*function\s*(\w*)\s*\(/)[1])}function u(a,b){if(null!=a){var c=a.length;if("undefined"==typeof c||"[object Function]"==t.call(a))return[a];b||(b=0);if(0<c-b){for(var d=[],e=0,g=b;g<c;)d[e++]=a[g++];return d}}return[]}function q(a,b,c){for(var d=[],e="function"==typeof b,g=0;g<a;g++)d[g]=e?b.call(c,
g,d):b;return d}var g=h.document,t=Object.prototype.toString,Q=function(){function a(f){if(c.test(f)){var b=f.split("."),d=b[0],m=b[1],e=b[2];switch(b.length){case 1:f=function(a){return null!=a?a[d]:a};break;case 2:f=function(a){return null!=a?a[d][m]:a};break;case 3:f=function(a){return null!=a?a[d][m][e]:a};break;default:f=function(a){if(null!=a){a=a[d][m][e];for(var f=3,c;c=b[f];f++)a=a[c]}return a}}return f}return new Function("object","return object != null ? object."+f+" : object")}var b=1,
c=/^[a-z$_][a-z$_0-9]*(\.[a-z$_][a-z$_0-9]*)*$/i,d=[],e={},g={};return function(c,A){var h,k,l;if(!c||c===r)return r;"function"==typeof c?(l=c.basisGetterId_)?h=d[Math.abs(l)-1]:(h=function(a){return c(a)},h.base=c,h.__extend__=Q,l=d.push(h),c.basisGetterId_=-l,h.basisGetterId_=l):(h=e[c])?l=h.basisGetterId_:(h=a(c),h.base=c,h.__extend__=Q,l=d.push(h),h.basisGetterId_=l,e[c]=h);k=null!=A&&typeof A;if(!k)return h;var n=g[l],p;if("string"==k)p=k+A;else if("function"==k)p=A.basisModId_;else if("object"!=
k)return h;if(p&&n&&n[p])return n[p];"function"==typeof h.base&&(h=h.base);switch(k){case "string":k=function(a){return ha.format(A,h(a))};break;case "function":p||(p=k+b++,A.basisModId_=p);k=function(a){return A(h(a))};break;default:k=function(a){return A[h(a)]}}k.base=h.base||h;k.__extend__=Q;p&&(n||(n={},g[l]=n),n[p]=k,k.mod=A,k.basisGetterId_=d.push(k));return k}}(),r=w(function(){},{__extend__:Q}),D=function(){var a={log:v,info:v,warn:v,error:v};"undefined"!=typeof console&&I(a,function(b){a[b]=
"bind"in Function.prototype&&"function"==typeof console[b]?Function.prototype.bind.call(console[b],console):function(){Function.prototype.apply.call(console[b],console,arguments)}});return a}(),y=h.setImmediate||h.msSetImmediate,P=h.clearImmediate||h.msSetImmediate;y&&(y=y.bind(h));P&&(P=P.bind(h));y||function(){var a=function(){var a={},f=1;y=function(){a[++f]={fn:arguments[0],args:u(arguments,1)};b(f);return f};P=function(b){delete a[b]};return function(b){var f=a[b];if(f)try{"function"==typeof f.fn?
f.fn.apply(void 0,f.args):(h.execScript||function(a){h.eval.call(h,a)})(String(f.fn))}finally{delete a[b]}}}(),b=function(b){setTimeout(function(){a(b)},0)};if(h.process&&"function"==typeof process.nextTick)b=function(b){process.nextTick(function(){a(b)})};else if(h.MessageChannel)b=function(b){var c=new h.MessageChannel;c.port1.onmessage=function(){a(b)};c.port2.postMessage("")};else{var c=h.postMessage&&!h.importScripts;if(c){var d=h.onmessage;h.onmessage=function(){c=!1};h.postMessage("","*");
h.onmessage=d}if(c)d=function(b){b&&b.source==h&&(b=String(b.data).split("basisjs.setImmediate")[1])&&a(b)},h.addEventListener?h.addEventListener("message",d,!0):h.attachEvent("onmessage",d),b=function(a){h.postMessage("basisjs.setImmediate"+a,"*")};else if(g&&"onreadystatechange"in g.createElement("script"))var e=b,b=function oa(c){"undefined"!=typeof $&&(b=e,$.head.ready(function(){b=function(b){var c=g.createElement("script");c.onreadystatechange=function(){a(b);c.onreadystatechange=null;$.remove(c);
c=null};$.head.add(c)}}));b===oa?e(c):b(c)}}}();var n="object"==typeof process&&"[object process]"==t.call(process),s=function(){var a=/^([^\/]+:|\/)/,b=/^[a-zA-Z0-9\-]+:\/?/,c=/^(?:[a-zA-Z0-9\-]+:)?\/\/[^\/]+\/?/,d=/[\?#].*$/,e={},g="",h;n?(g=require("path").resolve(".").replace(/\\/g,"/"),h=g.replace(/^[^\/]*/,""),g=g.replace(/\/.*/,"")):(h=location.pathname.replace(/[^\/]+$/,""),g=location.protocol+"//"+location.host);return e={baseURI:h,origin:g,normalize:function(a){a=(a||"").replace(b,"/").replace(c,
"/").replace(d,"");for(var f=[],e=a.split("/"),g=0;g<e.length;g++)".."==e[g]?(1<f.length||f[0])&&f.pop():!e[g]&&g||"."==e[g]||f.push(e[g]);return f.join("/")||("/"===a[0]?"/":"")},dirname:function(a){a=e.normalize(a);return a.replace(/\/([^\/]*)$|^[^\/]+$/,"")||("/"==a[0]?"/":".")},extname:function(a){return(a=e.normalize(a).match(/[^\/](\.[^\/\.]*)$/))?a[1]:""},basename:function(a,b){var f=e.normalize(a).match(/[^\\\/]*$/),f=f?f[0]:"";b==e.extname(f)&&(f=f.substring(0,f.length-b.length));return f},
resolve:function(b,c){for(var d=u(arguments).reverse(),m=[],g=!1,A=0;!g&&A<d.length;A++)"string"==typeof d[A]&&(m.unshift(d[A]),g=a.test(d[A]));g||m.unshift("/"==h?"":h);return e.normalize(m.join("/"))},relative:function(a,b){"string"!=typeof b&&(b=a,a=h);a=e.normalize(a);b=e.normalize(b);if("/"==a[0]&&"/"!=b[0])return a;if("/"==b[0]&&"/"!=a[0])return b;for(var f=a.replace(/^\/$/,"").split(/\//),c=b.replace(/^\/$/,"").split(/\//),d=[],m=0;c[m]==f[m]&&"string"==typeof f[m];)m++;for(f=f.length-m;0<
f;f--)d.push("..");return d.concat(c.slice(m).filter(Boolean)).join("/")}}}(),L={path:{basis:""}},M=function(){function a(b){return"function"==typeof b&&!!b.basisClassId_}function b(a){for(var f=this;f&&f!==a;)f=f.superClass_;return f===a}function c(k,n){var p=g++;"function"!=typeof k&&(k=l);var q=function(){};q.prototype=k.prototype;for(var q=new q,p={basisClassId_:p,superClass_:k,extendConstructor_:!!k.extendConstructor_,isSubclassOf:b,subclass:function(){return c.apply(null,[t].concat(u(arguments)))},
extend:d,__extend__:function(b){return b&&b!==h&&("object"==typeof b||"function"==typeof b&&!a(b))?l.create.call(null,t,b):b},prototype:q},r=1,s;s=arguments[r];r++)p.extend(s);var t=p.extendConstructor_?function(a){this.basisObjectId=e.id++;var b,f;for(f in a)b=this[f],this[f]=b&&b.__extend__?b.__extend__(a[f]):a[f];this.init();this.postInit()}:function(){this.basisObjectId=e.id++;this.init.apply(this,arguments);this.postInit()};q.constructor=t;for(var v in q)q[v]===h&&(q[v]=t);w(t,p);return t}function d(b){var c=
this.prototype;"function"!=typeof b||a(b)||(b=b(this.superClass_.prototype));b.prototype&&(b=b.prototype);for(var e in b){var m=b[e],g=c[e];"className"==e||"extendConstructor_"==e?this[e]=m:c[e]=g&&g.__extend__?g.__extend__(m):m}k&&b[e="toString"]!==t&&(c[e]=b[e]);return this}var e={id:1},g=1,h={},k=function(){for(var a in{toString:1})return!1;return!0}(),l=w(c,{className:"basis.Class",extendConstructor_:!1,prototype:{basisObjectId:0,constructor:null,init:function(){},postInit:function(){},destroy:function(){for(var a in this)hasOwnProperty.call(this,
a)&&(this[a]=null);this.destroy=v}}}),n=function(a,b,f){return{__extend__:function(a){if(!a||a&&a.__extend__)return a;var f=function(){};f.prototype=this;f=new f;b(f,a);return f}}.__extend__(a||{})},p=function(a){return n(a,w,"extensibleProperty")};return w(l,{SELF:h,create:c,isClass:a,customExtendProperty:n,extensibleProperty:p,nestedExtendProperty:function(a){return n(a,function(a,b){for(var f in b){var c=a[f];a[f]=c&&c.__extend__?c.__extend__(b[f]):p(b[f])}},"nestedExtendProperty")},oneFunctionProperty:function(a,
b){var f=function(b){var c={__extend__:f};if(b){if(b.__extend__)return b;for(var d in b)b[d]&&(c[d]=a)}return c};return f(b||{})}})}(),F=M(null,{className:"basis.Token",value:null,handler:null,deferredToken:null,bindingBridge:{attach:function(a,b,c){a.attach(b,c)},detach:function(a,b,c){a.detach(b,c)},get:function(a){return a.get()}},init:function(a){this.value=a},get:function(){return this.value},set:function(a){this.value!==a&&(this.value=a,this.apply())},attach:function(a,b){this.handler={fn:a,
context:b,handler:this.handler}},detach:function(a,b){for(var c=this,d;d=c,c=c.handler;)if(c.fn===a&&c.context===b){c.fn=v;d.handler=c.handler;break}},apply:function(){for(var a=this.get(),b=this;b=b.handler;)b.fn.call(b.context,a)},deferred:function(){var a=this.deferredToken;a||(a=this.deferredToken=new K.DeferredToken(this.value),this.attach(a.set,a));return a},destroy:function(){this.deferredToken&&(this.deferredToken.destroy(),this.deferredToken=null);this.value=this.handler=null;this.detach=
this.attach=v}}),T=function(){function a(){var f=b;b={};c=null;for(var d in f)f[d].apply()}var b={},c;return function(d){d.basisObjectId in b||(b[d.basisObjectId]=d,c||y(a))}}(),N=F.subclass({className:"basis.DeferredToken",set:function(a){this.value!==a&&(this.value=a,T(this))},deferred:function(){return this}}),a={},b={},d={};(function(){var a="undefined"!=typeof ma?ma:null;if(a){for(var c in a)b[s.resolve(c)]=a[c];ma=null}})();var k=function(a,c){if(c||!b.hasOwnProperty(a)){var d="";if(n)try{d=
require("fs").readFileSync(a,"utf-8")}catch(e){}else{var g=new XMLHttpRequest;g.open("GET",a,!1);g.setRequestHeader("If-Modified-Since",(new Date(0)).toGMTString());g.setRequestHeader("X-Basis-Resource",1);g.send("");200<=g.status&&400>g.status&&(d=g.responseText)}b[a]=d}return b[a]},p=function(f){f=s.resolve(f);if(!a[f]){var c=p.extensions[s.extname(f)],d=!1,e=!1,g,h=function(){if(d)return g;var a=k(f);c?e||(e=!0,g=c(a,f)):g=a;d=!0;E(h);h.apply();return g};w(h,w(new F,{url:f,fetch:function(){return h()},
toString:function(){return"[basis.resource "+f+"]"},isResolved:function(){return d},update:function(a){a=String(a);d&&a==b[f]||(b[f]=a,c?e&&!c.permanent&&(g=c(a,f),E(h),h.apply()):(g=a,d=!0,E(h),h.apply()))},reload:function(){var a=b[f],c=k(f,!0);c!=a&&(d=!1,h.update(c))},get:function(a){return a?k(f):h()},ready:function(a,b){if(d&&(a.call(b,h()),c&&c.permanent))return;h.attach(a,b);return h}}));a[f]=h}return a[f]};w(p,{isResource:function(b){return b?a[b.url]===b:!1},isResolved:function(a){return(a=
p.get(a))?a.isResolved():!1},exists:function(b){return a.hasOwnProperty(s.resolve(b))},get:function(a){a=s.resolve(a);return p.exists(a)?p(a):null},getFiles:function(f){return G(f?b:a).map(s.relative)},extensions:{".js":w(function(a,b){var c=ea[b];if(!c){var d=!0,c=s.dirname(b)+"/"+s.basename(b,s.extname(b)),g;for(g in L.path){var h=L.path[g]+g+"/";if(b.substr(0,h.length)==h){d=!1;c=c.substr(L.path[g].length);break}}c=c.replace(/\./g,"_").replace(/^\//g,"").replace(/\//g,".");d&&(c="implicit."+c)}l[c]||
(g=W(c),g.exports=S({path:g.path,exports:g.exports},b,a).exports,g.exports&&g.exports.constructor===Object&&e(g,g.exports));return l[c].exports},{permanent:!0}),".css":function(a,b){var c=ka.resources[b];c?c.updateCssText(a):c=new ka(b);return c},".json":function(a,b){if("object"==typeof a)return a;var c;try{a=String(a),c=K.json.parse(a)}catch(d){}return c||null}}});var S=function(a,b,c){var d=s.dirname(b)+"/",e=c;a.exports||(a.exports={});"function"!=typeof e&&(e=R(b,"exports module basis global __filename __dirname resource require".split(" "),
'"use strict";\n'+c));"function"==typeof e&&e.call(a.exports,a.exports,a,K,h,b,d,function(a){return p(s.resolve(d,a))},function(a,b){return X(a,b||d)});return a},l={},z={},ea={},ba=H(L.path);(function(a){if(a="undefined"!=typeof na?na:null)for(var b in a){var c=s.resolve(b),d=a[b];ea[c]=d;z[d]=c}})();var U=M(null,{className:"basis.Namespace",init:function(a){this.name=a;this.exports={path:this.name}},toString:function(){return"[basis.namespace "+this.path+"]"},extend:function(a){w(this.exports,a);
return e(this,a)}}),X=function(){if(n){var a=module.constructor.prototype;return function(b,c){if(/[^a-z0-9_\.]/i.test(b)&&".js"!=s.extname(b))return b=s.resolve(c,b),require(b);var d=a._compile,g=W(b);a._compile=function(a,b){this.basis=K;a='var node_require = require;\nvar basis = module.basis;\nvar resource = function(filename){ return basis.resource(__dirname + "/" + filename) };\nvar require = function(filename, baseURI){ return basis.require(filename, baseURI || __dirname) };\n'+a;d.call(w(this,
g),a,b)};var h=require(__dirname+"/"+b.replace(/\./g,"/"));(g.exports=h)&&h.constructor===Object&&e(g,h);a._compile=d;return h}}return function(a,b){a=/[^a-z0-9_\.]/i.test(a)||".js"==s.extname(a)?s.resolve(b,a):J(a);return p(a).fetch()}}();e(Function.prototype,{bind:function(a){var b=this,c=u(arguments,1);return c.length?function(){return b.apply(a,c.concat.apply(c,arguments))}:function(){return b.apply(a,arguments)}}});e(Array,{isArray:function(a){return"[object Array]"===t.call(a)}});e(Array.prototype,
{indexOf:function(a,b){b=parseInt(b,10)||0;if(0>b)return-1;for(;b<this.length;b++)if(this[b]===a)return b;return-1},lastIndexOf:function(a,b){var c=this.length;b=parseInt(b,10);for(b=isNaN(b)||b>=c?c-1:(b+c)%c;0<=b;b--)if(this[b]===a)return b;return-1},forEach:function(a,b){for(var c=0,d=this.length;c<d;c++)c in this&&a.call(b,this[c],c,this)},every:function(a,b){for(var c=0,d=this.length;c<d;c++)if(c in this&&!a.call(b,this[c],c,this))return!1;return!0},some:function(a,b){for(var c=0,d=this.length;c<
d;c++)if(c in this&&a.call(b,this[c],c,this))return!0;return!1},filter:function(a,b){for(var c=[],d=0,e=this.length;d<e;d++)d in this&&a.call(b,this[d],d,this)&&c.push(this[d]);return c},map:function(a,b){for(var c=[],d=0,e=this.length;d<e;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c},reduce:function(a,b){var c=this.length,d=arguments.length;if(0==c&&1==d)throw 1;var e,g=0;1<d&&(e=b,g=1);for(d=0;d<c;d++)d in this&&(e=g++?a.call(null,e,this[d],d,this):this[d]);return e}});var V={flatten:function(a){return a.concat.apply([],
a)},repeat:function(a,b){return V.flatten(q(parseInt(b,10)||0,a))},search:function(a,b,c,d){a.lastSearchIndex=-1;c=Q(c||Z);d=parseInt(d,10)||0;for(var e=a.length;d<e;d++)if(c(a[d])===b)return a[a.lastSearchIndex=d]},lastSearch:function(a,b,c,d){a.lastSearchIndex=-1;c=Q(c||Z);var e=a.length;d=isNaN(d)||null==d?e:parseInt(d,10);for(e=d>e?e:d;0<e--;)if(c(a[e])===b)return a[a.lastSearchIndex=e]},add:function(a,b){return-1==a.indexOf(b)&&!!a.push(b)},remove:function(a,b){var c=a.indexOf(b);return-1!=c&&
!!a.splice(c,1)},has:function(a,b){return-1!=a.indexOf(b)},sortAsObject:function(a,b,c,d){b=Q(b);d=d?-1:1;return a.map(function(a,c){return{i:c,v:b(a)}}).sort(c||function(a,b){return d*(a.v>b.v||-(a.v<b.v)||(a.i>b.i?1:-1))}).map(function(b){return a[b.i]},a)}};Y(Array,V);if(![1,2].splice(1).length){var da=Array.prototype.splice;Array.prototype.splice=function(){var a=u(arguments);2>a.length&&(a[1]=this.length);return da.apply(this,a)}}var fa=/([\/\\\(\)\[\]\?\{\}\|\*\+\-\.\^\$])/g,c=/\{([a-z\d_]+)(?::([\.0])(\d+)|:(\?))?\}/gi;
e(String,{toLowerCase:function(a){return String(a).toLowerCase()},toUpperCase:function(a){return String(a).toUpperCase()},trim:function(a){return String(a).trim()},trimLeft:function(a){return String(a).trimLeft()},trimRight:function(a){return String(a).trimRight()}});e(String.prototype,{trimLeft:function(){return this.replace(/^\s+/,"")},trimRight:function(){return this.replace(/\s+$/,"")},trim:function(){return this.trimLeft().trimRight()}});var ha={toObject:function(a,b){try{return(new Function("return 0,"+
a))()}catch(c){if(b)throw 2;}},repeat:function(a,b){return Array(parseInt(b,10)+1||0).join(a)},qw:function(a){return(a=a.trim())?a.split(/\s+/):[]},forRegExp:function(a){return a.replace(fa,"\\$1")},format:function(a,b){var d=u(arguments,1);"object"==typeof b&&w(d,b);return a.replace(c,function(a,b,c,f,e){a=b in d?d[b]:e?"":a;return c&&!isNaN(a)?(a=Number(a),"."==c?a.toFixed(f):ia.lead(a,f)):a})},capitalize:function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()},camelize:function(a){return a.replace(/-(.)/g,
function(a,b){return b.toUpperCase()})},dasherize:function(a){return a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})}};Y(String,ha);if(11!="|||".split(/\|/).length+"|||".split(/(\|)/).length){var x=String.prototype.split;String.prototype.split=function(a,b){if(!a||!1==a instanceof RegExp||""==a.source)return x.apply(this,arguments);var c=[],d=0,e;for(a.global||(a=RegExp(a.source,/\/([mi]*)$/.exec(a)[1]+"g"));e=a.exec(this);)e[0]=this.substring(d,e.index),c.push.apply(c,e),d=a.lastIndex;
c.push(this.substr(d));return c}}if("2"!="12".substr(-1)){var ca=String.prototype.substr;String.prototype.substr=function(a,b){return ca.call(this,0>a?Math.max(0,this.length+a):a,b)}}var ia={fit:function(a,b,c){return!isNaN(b)&&a<b?Number(b):!isNaN(c)&&a>c?Number(c):a},lead:function(a,b,c){return String(a).replace(/\d+/,function(a){return 1<(b-=a.length-1)?Array(b).join(c||0)+a:a})},group:function(a,b,c){return String(a).replace(/\d+/,function(a){return a.replace(/\d/g,function(d,f){return!f+(a.length-
f)%(b||3)?d:(c||" ")+d})})},format:function(a,b,c,d,e,g){a=a.toFixed(b);if(c||g)a=a.replace(/(\d+)(\.?)/,function(a,b,d){return(c?K.number.group(Number(b),3,c):b)+(d?g||d:"")});d&&(a=a.replace(/^-?/,"$&"+(d||"")));return a+(e||"")}};Y(Number,ia);e(Date,{now:function(){return Number(new Date)}});var ja=function(){function a(){if("complete"==g.readyState&&g.body&&!c++)for(;d;)d.callback.call(d.context),d=d.next}function b(){try{g.documentElement.doScroll("left"),a()}catch(c){setTimeout(b,1)}}var c=
!g||"complete"==g.readyState&&!!g.body,d;if(!c)if(g.addEventListener)g.addEventListener("DOMContentLoaded",a,!1),h.addEventListener("load",a,!1);else{g.attachEvent("onreadystatechange",a);h.attachEvent("onload",a);try{!h.frameElement&&g.documentElement.doScroll&&b()}catch(e){}}return function(a,b){c?a.call(b):d={callback:a,context:b,next:d}}}(),$=function(){function a(b){if(g&&!h[b]&&(h[b]=g[b]||g.getElementsByTagName(b)[0],h[b])){var c=k[b];delete k[b];for(var d=0,f;f=c[d];d++)f[0].call(f[1],h[b])}return h[b]}
function b(){var d=this[0],e=this[1],g=this[2];c(e);var h=a(d);h?(!0===g&&(g=h.firstChild),g&&g.parentNode===h||(g=null),h.insertBefore(e,g)):k[d].push([b,[d,e,g]])}function c(a){for(var b in k){var d=V.search(k[b],a,function(a){return a[1]&&a[1][1]});d&&V.remove(k[b],d)}a&&a.parentNode&&1==a.parentNode.nodeType&&a.parentNode.removeChild(a)}function d(){e&&a("head")&&a("body")&&(e=clearInterval(e))}var e,h={},k={head:[],body:[]};!g||a("head")&&a("body")||(e=setInterval(d,5),ja(d));return{head:{ready:function(a,
b){k.head?k.head.push([a,b]):a.call(b,h.head)},add:function(a,c){b.call(["head",a,c])}},body:{ready:function(a,b){k.body?k.body.push([a,b]):a.call(b,h.body)},add:function(a,c){b.call(["body",a,c])}},remove:c}}(),ga=function(){function a(d){c.globalDestroy=!0;c.add=v;for(c.remove=v;d=b.pop();)if("function"==typeof d.destroy)try{d.destroy()}catch(f){}else for(var e in d)d[e]=null;b.length=0}var b=[];if("attachEvent"in h)h.attachEvent("onunload",a);else if("addEventListener"in h)h.addEventListener("unload",
a,!1);else return{add:v,remove:v};var c={add:function(a){null!=a&&b.push(a)},remove:function(a){V.remove(b,a)}};return c}(),ka=function(){function a(b){l.setAttribute("href",b);$.head.add(l,!0)}function b(){l.setAttribute("href",location.href);$.remove(l)}function c(){a(this.baseURI);this.element||(this.element=g.createElement("style"),h||(this.textNode=this.element.appendChild(g.createTextNode(""))));$.head.add(this.element);this.syncCssText();b()}var d={},e=!0,h;try{h=!g.createElement("style").appendChild(g.createTextNode(""))}catch(k){h=
!0}ga.add({destroy:function(){e=!1;for(var a in d)d[a].destroy();d=null}});var l=g&&g.createElement("base"),n=M(null,{className:"basis.CssResource",inUse:0,url:"",baseURI:"",cssText:"",resource:null,element:null,textNode:null,init:function(a){this.url=s.resolve(a);this.baseURI=s.dirname(a)+"/";d[a]=this},updateCssText:function(c){this.cssText!=c&&(this.cssText=c,this.inUse&&this.element&&(a(this.baseURI),this.syncCssText(),b()))},syncCssText:function(){this.textNode?this.textNode.nodeValue=this.cssText:
this.element.styleSheet.cssText=this.cssText},startUse:function(){if(!this.inUse){if(!this.resource){var a=p(this.url);this.resource=a;this.cssText=a.get(!0)}$.head.ready(c,this)}this.inUse+=1},stopUse:function(){this.inUse&&(this.inUse-=1,!this.inUse&&this.element&&$.remove(this.element))},destroy:function(){this.element&&e&&$.remove(this.element);this.cssText=this.resource=this.textNode=this.element=null}});n.resources=d;return n}(),K=W("basis").extend({version:"1.2.0-dev",NODE_ENV:n,config:L,platformFeature:{},
resolveNSFilename:J,patch:function(a,b){a=/[^a-z0-9_\.]/i.test(a)||".js"==s.extname(a)?s.resolve(a):J(a);d[a]?d[a].push(b):d[a]=[b];var c=p.get(a);c&&c.isResolved()&&b(c.get(),c.url)},namespace:W,require:X,resource:p,asset:function(a){return a},setImmediate:y,clearImmediate:P,nextTick:function(){y.apply(null,arguments)},Class:M,Token:F,DeferredToken:N,getter:Q,ready:ja,cleaner:ga,console:D,path:s,doc:$,object:{extend:w,complete:e,keys:G,values:function(a){var b=[],c;for(c in a)b.push(a[c]);return b},
slice:H,splice:function(a,b){var c={};if(!b)return w(c,a);for(var d=0,e;e=b[d++];)e in a&&(c[e]=a[e],delete a[e]);return c},merge:C,iterate:I},fn:{$undefined:function(a){return void 0==a},$defined:function(a){return void 0!=a},$isNull:function(a){return null==a||void 0==a},$isNotNull:function(a){return null!=a&&void 0!=a},$isSame:function(a){return a===this},$isNotSame:function(a){return a!==this},$self:Z,$const:function(a){return function(){return a}},$false:function(){return!1},$true:function(){return!0},
$null:function(){return null},$undef:v,getter:Q,nullGetter:r,wrapper:function(a){return function(b){var c={};c[a]=b;return c}},lazyInit:function(a,b){var c=0,d,e;return d=function(){c++||(d.inited=!0,d.data=e=a.apply(b||this,arguments));return e}},lazyInitAndRun:function(a,b,c){var d=0,e,g;return e=function(){d++||(e.inited=!0,e.data=g=a.call(c||this));b.apply(g,arguments);return g}},runOnce:function(a,b){var c=0;return function(){if(!c++)return a.apply(b||this,arguments)}}},array:w(u,C(V,{from:u,
create:q})),string:C(ha,{isEmpty:function(a){return null==a||""==String(a)},isNotEmpty:function(a){return null!=a&&""!=String(a)}}),number:ia,bool:{invert:function(a){return!a}},json:{parse:"undefined"!=typeof JSON?JSON.parse:function(a){return ha.toObject(a,!0)}}});W("basis.dev").extend(D);L.autoload&&X(L.autoload)})(this)}).call(this)